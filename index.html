<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class='container'>
        <h1>URL Shortener</h1>
        <form id="Shortner-form">
            <div>
            <label for="url">Enter URL:</label>
            <input type="url" name="url" id="url" required>
            </div>
            <div>
            <label for="short-form">Short Code:</label>
            <input type="text" id="short-form" name="short-form" required>
            </div>
            <div id="box">
            <button type="submit" id="submit">Shorten</button>
            </div>
        </form>
        <h2>Shortened URLs</h2>
        <ul id="shortened-urls"></ul>
    </div>
    <script>
        
        const displayLink=async (shortCode,url)=>{
            const list=document.querySelector("#shortened-urls");
            list.innerHTML="";
            const li=document.createElement("li");
            const truncatedURL=url.length>=30?`${url.slice(0,30)}...`:url;
            li.innerHTML=`<a href='${shortCode}' target=_blank>${window.location.origin}/${shortCode}</a>  ->   ${truncatedURL}`;
            list.appendChild(li);
        }
        const form=document.querySelector('#Shortner-form');
        form.addEventListener('submit',async (event)=>{
            event.preventDefault();
            const formData=new FormData(event.target);
            const url=formData.get("url");
            const shortCode=formData.get("short-form");
            console.log(url,shortCode);
            try {
                const response=await fetch("/shorten",{
                    method:"POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({url,shortCode})
                });
                if(response.ok){
                    const {shortCode,finalUrl} =await response.json();
                    alert("Form submitted successfully");
                    event.target.reset();
                    displayLink(shortCode,finalUrl);
                }else{
                    const errorMessage=await response.text();
                    alert(errorMessage);
                }
            } catch (error) {
                console.log(error);
            }
            
        });
        displayLinks();
    </script>
    
</body>
</html>